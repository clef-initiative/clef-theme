{{ $color := .Site.Params.color | default "stone" }}
{{ $gray := .Site.Params.gray | default "stone" }}

<footer class="
    border-t-4
    border-{{ $gray }}-200
    dark:border-{{ $gray }}-800
    py-4
">
  <div class="md:max-w-2xl max-w-full mx-auto px-4 flex flex-row justify-between items-center gap-4">
    <!-- Element 2: CLEF Initiative Logo -->
    <div class="flex-1">
      <a href="https://www.clef-initiative.eu/" class="
      ">
        <img class="
          h-32
          cursor-pointer
          max-w-full
          mr-auto
          object-scale-down
        " src="/img/clef-initiative-logo.png" alt="Logo">
        </a>
    </div>
    <!-- Element 3: Main Navigation -->
    <div class="flex-1">
      {{ if .Site.Menus.main }}
      <nav class="flex flex-col gap-4" aria-label="Footer navigation">
        {{ range .Site.Menus.main }}
        <a
                href="{{ .URL }}"
                class="text-sm text-{{ $gray }}-600 dark:text-{{ $gray }}-400 hover:text-{{ $gray }}-900 dark:hover:text-{{ $gray }}-100 transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500"
                {{ if strings.HasPrefix .URL "http" }}target="_blank" rel="noopener noreferrer"{{ end }}
        >
        {{ .Name }}
        </a>
        {{ end }}
      </nav>
      {{ end }}
    </div>
    <!-- Element 4: Footer Navigation -->
    <div class="flex-1">
      {{ if .Site.Menus.footer }}
      <nav class="flex flex-col gap-4" aria-label="Footer navigation">
        {{ range .Site.Menus.footer }}
        <a
                href="{{ .URL }}"
                class="text-sm text-{{ $gray }}-600 dark:text-{{ $gray }}-400 hover:text-{{ $gray }}-900 dark:hover:text-{{ $gray }}-100 transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500"
                {{ if strings.HasPrefix .URL "http" }}target="_blank" rel="noopener noreferrer"{{ end }}
        >
        {{ .Name }}
        </a>
        {{ end }}
      </nav>
      {{ end }}
    </div>
  </div>
  <div class="md:max-w-2xl max-w-full mx-auto py-2 flex flex-row justify-between items-center gap-4 mt-8">
    <!-- Element 1: Dark mode toggle -->
    <span class="text-sm text-{{ $gray }}-400">Â© {{ with .Site.Copyright }}{{ . | markdownify}}{{ end }}</span>
    <a
      onclick="toggleTheme()"
      class="
        p-3
        flex-none
        rounded-xl
        text-{{ $gray }}-600 dark:text-{{ $gray }}-400 hover:text-{{ $gray }}-900 dark:hover:text-{{ $gray }}-100
        hover:bg-{{ $gray }}-50 dark:hover:bg-{{ $gray }}-800 transition-colors
        focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500"
      role="button"
      aria-label="Toggle dark mode"
      title="Toggle dark/light mode"
      id="theme-toggle"
    >
      <!-- Sun icon (shown in dark mode) -->
      <svg class="size-5 hidden dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"/>
        <path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/>
      </svg>
      <!-- Moon icon (shown in light mode) -->
      <svg class="size-5 block dark:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
    </a>
  </div>
</footer>

<!-- Dark mode toggle JS -->
<script>
    function initTheme() {
        // Apply theme on load to avoid FOUC
        const isDark = localStorage.theme === 'dark' ||
            (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);

        document.documentElement.classList.toggle('dark', isDark);
    }

    function toggleTheme() {
        const html = document.documentElement;
        const isDark = html.classList.contains('dark');

        if (isDark) {
            // Switch to light mode
            html.classList.remove('dark');
            localStorage.theme = 'light';
        } else {
            // Switch to dark mode
            html.classList.add('dark');
            localStorage.theme = 'dark';
        }

        // Force a repaint to ensure icon changes are visible
        document.getElementById('theme-toggle').offsetHeight;
    }

    // Initialize theme on page load
    document.addEventListener('DOMContentLoaded', initTheme);

    // Also run immediately in case DOMContentLoaded already fired
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTheme);
    } else {
        initTheme();
    }
</script>
